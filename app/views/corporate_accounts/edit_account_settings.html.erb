<%= render :partial => "layouts/bread_crumbs" %>

<h1>Edit Corporate Details</h1>

<%= form_for @corporate_profile, url: update_corporate_settings_path(@corporate_profile), method: :post do |f| %>
  <div class="card mb-30">
    <h3 class="card-label">Company Details</h3>
    
    <% if @corporate_profile.errors.any? %>
      <% errors = true %>
      <% error_messages = @corporate_profile.errors.messages %>
    <% end %>

    <%= f.label :business_name, 'Company Name' %>
    <% if errors && error_messages[:business_name].present? %>
      <span class="error-label"> - <%= error_messages[:business_name].first %></span>
    <% end %>
    <%= f.text_field :business_name, { class: ("input-error" if errors && error_messages[:business_name].present?),
                                       :maxlength => get_max_length(:default) } %>

    <%= f.label :web_address, 'Web Address' %>
    <% if errors && error_messages[:web_address].present? %>
      <span class="error-label"> - <%= error_messages[:web_address].first %></span>
    <% end %>
    <%= f.text_field :web_address, { class: ("input-error" if errors && error_messages[:web_address].present?),
                                     type: "url", onblur: "checkURL(this)", onsubmit: "checkURL(this)",
                                     :maxlength => get_max_length(:web) } %>

    <%= f.label :street_address, 'Street Addess' %>
    <% if errors && error_messages[:street_address].present? %>
      <span class="error-label"> - <%= error_messages[:street_address].first %></span>
    <% end %>
    <%= f.text_field :street_address, { class: ("input-error" if errors && error_messages[:street_address].present?),
                                        :maxlength => get_max_length(:default) } %>

    <%= f.label :city, 'City' %>
    <% if errors && error_messages[:city].present? %>
      <span class="error-label"> - <%= error_messages[:city].first %></span>
    <% end %>
    <%= f.text_field :city, { class: ("input-error" if errors && error_messages[:city].present?),
                              :maxlength => get_max_length(:default) } %>

   <span class="state-input">
      <% state_error = errors && error_messages[:state].present? %>
      <% state_class = state_error ? "styled-select input-error" : "styled-select" %>
      <%= f.label :state %>
      <% if errors && error_messages[:state].present? %>
        <span class="error-label"> - <%= error_messages[:state].first %></span>
      <% end %>
      
      <div class= "<%= state_class %>" >
        <%= f.select :state, options_for_select(us_states, f.object.try(:state)), :include_blank => "Select...", 
            class: ("input-error" if errors && error_messages[:state].present?) %>
      </div>
    </span>
    <span class="zip-input">
      <%= f.label :zip, 'Zip Code' %>
      <% if errors && error_messages[:zip].present? %>
        <span class="error-label"> - <%= error_messages[:zip].first %></span>
      <% end %>
      <%= render partial: 'layouts/zip_code', locals: { f: f, zip: :zip, errors: errors && error_messages[:zip].present? } %>
    </span>

    <%= f.label :phone_number, 'Phone Number' %>
    <% if errors && error_messages[:phone_number].present? %>
      <span class="error-label"> - <%= error_messages[:phone_number].first %></span>
    <% end %>
    <% phone_additional_classes = errors && error_messages[:phone_number].present? ? " input-error" : "" %>
    <%= render partial: 'layouts/phone_number', locals: { f: f, phone: :phone_number, phone_additional_classes: phone_additional_classes } %>

    <%= f.label :fax_number, 'Fax Number' %>
    <%= render partial: 'layouts/phone_number', locals: { f: f, phone: :fax_number } %>

    <%= f.label :company_logo, 'Copmany Logo' %>
    <p></p>
    
    <% if @corporate_profile.company_logo.blank? %>
      <% no_logo = true %>
    <% end %>
    <div class="avatar-wrapper">
      <% if @corporate_profile.company_logo.present? %>
        <div id="new-avatar_account">
          <%= image_tag(get_file_url(@corporate_profile.company_logo), class: "max-w-80", id: "image_view_account", alt: 'company logo') %>
        </div>
      <% else %>
        <div id="new-avatar_account" style="display: none;">
          <%= image_tag('', class: "max-w-80", id: "image_view_account", alt: 'company logo') %>
        </div>
      <% end %>
    </div>

    <% upload_args = "'#{file_picker_api_key}', #{FilepickerService.fetch_policy(:avatar)}, '_account', false" %>

    <a onclick="uploadThumbnailWithFilestack(<%= upload_args %>)" class="no-underline-link" id="action-avatar-link">Update Logo</a>
    <a onclick="clearAvatarPhoto('_account')" class="no-underline-link neighbour-link remove-button_account" id="action-avatar-link"
    <% if no_logo %> style="display: none;" <% end %>>Remove Logo</a>
    
    <%= f.text_field :company_logo, id: "photo_url_account", style: "display: none;" %>
  </div>
  <%= render partial: 'layouts/save_cancel_buttons', locals: { previous_path: back_path || corporate_account_settings_path, f: f } %>
<% end %>

<%= javascript_include_tag 'url_validation' %>