<div class="card trusts mb-30">
  <%= f.hidden_field :id, id: "trust_id_#{index}" %>

  <h3 class="card-label">Trust Details</h3>

  <label>Trust Name<span class="wtl-required-field"> Required</span></label>
  <%= f.text_field :name, value: data.name %>

  <label>Attorney, Accountant or Advisor(s)</label>
  <div class="chosen-styled-select">
    <%= contact_select_with_create_new(f, :agent_ids, @contacts, id: "trust_agent_id_#{index}", multiple: false) %>
  </div>

  <label>Trustee(s)</label>
  <div class="chosen-styled-select">
    <%= contact_select_with_create_new(f, :trustee_ids, @contacts, id: "trust_trustee_id_#{index}") %>
  </div>

  <label>Successor Trustee(s)</label>
  <div class="chosen-styled-select">
    <%= contact_select_with_create_new(f, :successor_trustee_ids, @contacts, id: "trust_successor_id_#{index}") %>
  </div>

  <label>Notes</label>
  <p><%= f.text_area :notes, id: "trust_notes_id_#{index}" %></p>

  <section class="shared-with edit-shared">
    <h3 class="card-label shared-label">
      <svg class="icon" viewBox="0 0 20 20">
        <use xlink:href="#icon-Safe"></use>
      </svg> Shared With
    </h3>
    <label>Shared With</label><br>
    <div class="chosen-styled-select">
      <%= contact_select_with_create_new(f, :share_ids, @contacts_shareable, id: "trust_share_id_#{index}") %>
    </div>
  </section>

  <% if data.id %>
    <%= link_to 'Delete', "#{yield(:delete_path)}#{data.id}", method: :delete,
        data: { confirm: "Deleting this '#{yield(:question_title)}' will permanently remove it from ZokuVault." },
        class: 'button small-button secondary-button', id: 'delete-trust' %>
  <% end %>

</div>

<script>
  clearForm = function($newWtlForm, old_id, new_id){
    new_vault_entry_id = "vault_entry_" + new_id;
    $newWtlForm.find("[id^='trust_id_']").attr({
      id: "trust_id_" + new_id,
      value: ""
    });
    $newWtlForm.find("[id^='trust_id_']").attr("name", new_vault_entry_id + "[id]");
    $newWtlForm.find("[id^='vault_entry_']").attr({
      name: new_vault_entry_id + "[name]",
      id: new_vault_entry_id + "_name"
    });

    $newWtlForm.find("#trust_agent_id_" + old_id).attr({
      name: new_vault_entry_id +"[agent_ids][]",
      id: "trust_agent_id_" + new_id
    });
    $newWtlForm.find("#trust_agent_id_" + new_id + " option").prop("selected", false);

    $newWtlForm.find("#trust_trustee_id_" + old_id).attr({
      name: new_vault_entry_id +"[trustee_ids][]",
      id: "trust_trustee_id_" + new_id
    });
    $newWtlForm.find("#trust_trustee_id_" + new_id + " option").prop("selected", false);

    $newWtlForm.find("#trust_successor_id_" + old_id).attr({
      name: new_vault_entry_id +"[successor_trustee_ids][]",
      id: "trust_successor_id_" + new_id
    });
    $newWtlForm.find("#trust_successor_id_" + new_id + " option").prop("selected", false);

    $newWtlForm.find("#trust_share_id_" + old_id).attr({
      name: new_vault_entry_id +"[share_ids][]",
      id: "trust_share_id_" + new_id
    });
    
    $newWtlForm.find("#trust_notes_id_" + old_id).attr({
      name: new_vault_entry_id +"[notes]",
      id: "trust_notes_id_" + new_id
    });
    
    $newWtlForm.find("#trust_share_id_" + new_id + " option").prop("selected", false);
    $newWtlForm.find("#delete-trust").remove();
  }
$(document).ready(function(){
  url = "new/get_trusts_details";
  $.get(url, function(data) {
    data.forEach(function(form_values, index){
      $("#trust_agent_id_" + index).val(form_values[0]).trigger("chosen:updated");
      $("#trust_trustee_id_" + index).val(form_values[1]).trigger("chosen:updated");
      $("#trust_successor_id_" + index).val(form_values[2]).trigger("chosen:updated");
      $("#trust_share_id_" + index).val(form_values[3]).trigger("chosen:updated");
      $("#trust_id_" + index).val(form_values[4]).trigger("chosen:updated");
      $("#trust_notes_id_" + index).val(form_values[5]);
    });
  });
});
</script>
