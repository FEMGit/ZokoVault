<h1>Wills - Trusts - Legal</h1>

<section class="flex-boxes">
  <div class="flex-column">
    <div class="card cg-1 column-card wtl-info-wrapper wills">
      <% if @wills.any? %>
        <%= link_to content_tag(:a), wills_path, class: "whole-card-link" %>
        <div class="section header">
          <span class="fa-stack fa-1x icon-section">
            <span class="fa-stack-1x document-number"><%= document_count(current_user, @wills.name) %></span>
            <svg class="icon icon-document-1 ">
              <use xlink:href="#icon-document-1">
              </use>
            </svg>
          </span>
          <h3>Wills</h3>
        </div>
        <div class="section">
          <% get_primary_uniq(@wills) && get_primary_uniq(@wills).each do |primary| %>
            <span class="wtl-left-side field"><%= primary.name %></span>
            <span class="wtl-right-side field">Primary</span>
          <% end %>
          <% get_secondary_uniq(@wills) && get_secondary_uniq(@wills).each do |secondary| %>
            <span class="wtl-left-side field"><%= secondary.name %></span>
            <span class="wtl-right-side field">Secondary</span>
          <% end %>
        </div>
        <span class="clear"></span>
        <% get_advisor_uniq(@wills) && get_advisor_uniq(@wills).each do |advisor| %>
          <div class="section">
            <div class="wtl-left-side">
              <span class="agent-info field"><%= advisor.name %></span><br>
              <a class="agent-info field"><%= advisor.emailaddress %></a><br>
              <span class="agent-info field"><%= advisor.phone %></span>
            </div>
            <div class="wtl-right-side">
              <span class="user-circle field"><%= advisor.initials %></span>
            </div>
          </div>
          <span class="clear"></span>
        <% end %>
        <div class="section bottom">
          <% get_shares_uniq(@wills) && get_shares_uniq(@wills).each do |share| %>
            <% if share.present? %>
              <span class="user-circle"><%= share.initials %></span>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <h3>Wills</h3>
        <div class="section bottom">
          <span class="percent-complete">0% Complete</span>
        </div>
      <% end %>
      <%= link_to 'Add Details', new_will_path, class: "add-details-link" %>
      <span class="clear"></span>
    </div>
  </div>
  
  <div class="flex-column">
    <div class="card cg-2 column-card wtl-info-wrapper trusts">
      <% if @trusts.any? %>
        <%= link_to content_tag(:a), trusts_path, class: "whole-card-link" %>
        <div class="section header">
          <span class="fa-stack fa-1x icon-section">
            <span class="fa-stack-1x document-number"><%= document_count(current_user, @trusts.name) %></span>
            <svg class="icon icon-document-1 ">
              <use xlink:href="#icon-document-1">
              </use>
            </svg>
          </span>
          <h3>Trusts</h3>
        </div>
        <div class="section">
          <% @trusts.each do |trust| %>
            <span class="wtl-left-side field"><%= trust.name %></span>
          <% end %>
        </div>
        <span class="clear"></span>
        <% get_agents_uniq(@trusts) && get_agents_uniq(@trusts).each do |agent| %>
          <div class="section">
            <div class="wtl-left-side">
              <span class="agent-info field"><%= agent.name %></span><br>
              <a class="agent-info field"><%= agent.emailaddress %></a><br>
              <span class="agent-info field"><%= agent.phone %></span>
            </div>
            <div class="wtl-right-side">
              <span class="user-circle field"><%= agent.initials %></span>
            </div>
          </div>
          <span class="clear"></span>
        <% end %>
        <div class="section bottom">
          <% get_shares_uniq(@trusts) && get_shares_uniq(@trusts).each do |share| %>
            <% if share.present? %>
              <span class="user-circle"><%= share.initials %></span>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <h3>Trusts</h3>
        <div class="section bottom">
          <span class="percent-complete">0% Complete</span>
        </div>
      <% end %>
      <%= link_to 'Add Details', new_trust_path, class: "add-details-link" %>
      <span class="clear"></span>
    </div>
  </div>
  <div class="flex-column">
    <div class="card cg-3 column-card wtl-info-wrapper attorney">
      <% if @power_of_attorneys.any? %>
        <%= link_to content_tag(:a), power_of_attorneys_path, class: "whole-card-link" %>
        <div class="section header">
          <span class="fa-stack fa-1x icon-section">
            <span class="fa-stack-1x document-number"><%= document_count(current_user, "Legal") %></span>
            <svg class="icon icon-document-1 ">
              <use xlink:href="#icon-document-1">
              </use>
            </svg>
          </span>
          <h3>Powers of Attorney</h3>
        </div>
        <% @power_of_attorneys.each do |power_of_attorney| %>
          <div class="section">
            <div class="wtl-left-side">
              <%= power_of_attorney.agents && power_of_attorney.agents.map(&:name).join(", ") %>
            </div>
            <div class="wtl-right-side">
              <% if power_of_attorney.powers.present? %>
                <% power_of_attorney.powers.keys.each do |agent_power| %>
                  <div>
                    <%= agent_power %>
                  </div>
                <% end %>
              <% end %>
            </div>
            <span class="clear"></span>
          </div>
        <% end %>
        <div class="section bottom">
          <% get_shares_uniq(@power_of_attorneys) && get_shares_uniq(@power_of_attorneys).each do |share| %>
            <% if share.present? %>
              <span class="user-circle"><%= share.initials %></span>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <h3>Power of Attorney</h3>
        <div class="section bottom">
          <span class="percent-complete">0% Complete</span>
        </div>
      <% end %>
      <%= link_to 'Add Details', new_power_of_attorney_path, class: "add-details-link" %>
      <span class="clear"></span>
    </div>
  </div>
</section>


<div>
  <a class="add-link fr" href="<%= new_document_path(:category => @category, :return => "estate_planning") %>">
    <span class="circle-button">
      <svg class="icon circle-icon">
        <use xlink:href="#icon-plus-1"></use>
      </svg>
    </span>Add Document
  </a>
  <h1>Wills - Trusts - Legal Documents</h1>
</div>

<table>
  <tr>
    <%= render :partial => "layouts/documents_common_columns" %>
  </tr>
  <% @wtl_documents.each do |wtl_doc| %>
    <tr>
      <td>
        <%= render :partial => "layouts/document_links", :locals => {:document => wtl_doc} %>
      </td>
      <td><%= date_format(wtl_doc.updated_at) %></td>
      <td>
        <%= render :partial => "layouts/document_tags", :locals => {:document => wtl_doc} %>
      </td>
      <td>
        <%= render :partial => "layouts/share_with_contacts", :locals => {:shares => wtl_doc.shares} %>
      </td>
      <td>
        <%= link_to 'Edit', edit_document_path(wtl_doc), class: "outline-button small-button" %>
        <%= link_to 'Delete', document_path(wtl_doc), method: :delete, data: {confirm: 'Are you sure?'}, class: "outline-button small-button" %>
      </td>
    </tr>
  <% end %>
</table>

<script>
$(function() {
  $('.flex-boxes').masonry({
    columnWidth: '.flex-column',
    gutter: 20,
    percentPosition: true,
    itemSelector: '.flex-column'
  });
});
</script>