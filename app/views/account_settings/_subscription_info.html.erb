<label>Plan</label>
<p><%= plan.try(:name) || '--' %></p>

<label>Start Date</label>
<p><%= date_format(subscription.start_at) || '–' %></p>

<label>Next Invoice</label>
<% if next_invoice_amount.present? %>
  <p><%= "$#{next_invoice_amount / 100.0} - #{date_format(next_invoice_date)} - Automatic Collection" %></p>
<% else %>
  <% if @subscription_calceled == true %>
    <p>Subscription was canceled. It will be available until <%= date_format @subscription_end_time %></p>
  <% else %>
    <p>–</p>
  <% end %>
<% end %>

<label>Billing Info</label>
<% if card.present? %>
  <p>
    <%= "#{card[:brand]} XXXX-#{card[:last4]} exp. #{card[:exp_month]}/#{card[:exp_year]}" %>
    <%= link_to 'Update', update_subscription_information_path, class: 'no-underline-link' %>
  </p>
<% else %>
  <p>–</p>
<% end %>

<h3>Previous Invoices</h3>

<table id="documents-table">
  <thead>
    <tr>
      <th>Product</th>
      <th>Paid on</th>
      <th>Payment Amount</th>
      <th>Invoice</th>
    </tr>
  </thead>
  <tbody>
    <% invoices && invoices.each do |invoice| %>
      <tr>
        <td><%= invoice.lines.data.first.plan.name %></td>
        <td><%= date_format(DateTime.strptime(invoice.period_start.to_s, '%s')) %></td>
        <td><%= "$#{invoice.total / 100.0}" %></td>
        <td><%= link_to 'Invoice', invoice_information_path(invoice.id), class: 'no-underline-link', target: :_blank %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="mt-20">
  <%= link_to "Update Subscription", billing_info_path, class: "button primary-button big-button mt-10 inline-block fixed-width-big p-10" %>
  <% if @next_invoice_date.present? %>
    <%= link_to "Cancel Subscription", cancel_subscription_path, class: "button secondary-button big-button mt-10 inline-block fixed-width-big p-10" %>
  <% end %>
</div>

<script>
  $(document).ready(function(){
    $('#documents-table').DataTable( {
      paging: false,
      searching: false,
      info: false,
      aaSorting: [[1, 'asc']],
      'aoColumnDefs': [{
        'bSortable': false,
        'aTargets': ['nosort']
      }, {
        'bSearchable': false,
        'aTargets': ['nosearch']
      }],
    } );
  });
</script>
