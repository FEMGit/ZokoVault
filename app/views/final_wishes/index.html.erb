<h1>Final Wishes</h1>

<section class="flex-boxes">
  <% @groups && @groups.each do |group| %>
    <% group_title = group["label"] %>
    <div class="flex-column">
      <div class="card cg-<%= group["value"] %> mb-30">
        <%#= link_to content_tag(:a), final_wish_details(group_title), class: "whole-card-link" %>
        <% if final_wish_exists?(@final_wishes, group_title) %>
          <%= render :partial => "layouts/documents_count_icon", :locals => { :count => document_count(current_user, group_title, @category) } %>
        <% end %>

        <h3><%= group_title %></h3>

        <% if final_wish_exists?(@final_wishes, group_title) %>
          <% final_wish = wish_by_group(group_title) %>
          <% if final_wish && final_wish.primary_contact.present? %>

            <label>Primary Contact</label>
            <ul class="data-list">
              <li class="contact-pair">
                <%= final_wish.primary_contact.name %><br>
                <%= mail_to final_wish.primary_contact.emailaddress, final_wish.primary_contact.emailaddress, class:"link-on-top" %><br>
                <%= final_wish.primary_contact.phone %>
              </li>
            </ul>

          <% end %>
          
          <% final_wish_info = final_wish_info(group_title) %>
          <% if final_wish_info && get_shares_contact_uniq(final_wish_info.final_wishes).present? %>
            <label>Shared With</label>
            <section class="shared-list mb-20">
              <% get_shares_contact_uniq(final_wish_info.final_wishes).each do |contact| %>
                <%= render partial: "layouts/avatar_circle", locals: { :contact => contact } %>
              <% end %>
           </section>
         <% end %>

        <% end %>

        <% if final_wish_exists?(@final_wishes, group_title) %>
          <%= link_to 'View Details', final_wish_details(group_title), class: "small-button outline-button mt-20" %>
        <% else %>
          <%= link_to 'Add Details', final_wish_add_details(group_title),  class: "small-button outline-button mt-20" %>
        <% end %>
        <%#= link_to 'Add Details', final_wish_add_details(group_title), class: "link-on-top add-details" %>
      </div>
    </div>
  <% end %>
</section>

<a class="add-link fr" href="<%= new_document_path(:category => @category.name) %>">
  <span class="circle-button">
    <svg class="icon circle-icon">
      <use xlink:href="#icon-plus-1"></use>
    </svg>
  </span>Add Document
</a>
<h3>Final Wish Documents</h3>

<%= render :partial => "layouts/standard_document_table", :locals => {:documents => @documents} %>
<a class="edit-link" href='<%= share_category_category_path(Rails.application.config.x.FinalWishesCategory.downcase) %>'>
  <span class="circle-button">
    <svg class="icon circle-icon">
      <use xlink:href="#icon-pencil-1"></use>
    </svg>
  </span>Edit
</a>
<h3>Shared With</h3>

<div class="card mb-30 my_profile_info">
  <h3 class="card-label">Category Shared With</h3>

  <label>SHARED WITH</label>

  <% if @contacts_with_access.blank? %>
    <p>No shared access</p>
  <% else %>
    <% @contacts_with_access.each do |contact| %>
      <p><%= contact.initials %> </p>
    <% end %>
  <% end %>
</div>

<%= javascript_include_tag 'flex_boxes' %>
<script>
var is_safari = navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1;
if(!is_safari){
  $(function(){
    $('.flex-boxes').masonry({
      columnWidth: '.flex-column',
      gutter: 20,
      percentPosition: true,
      itemSelector: '.flex-column'
    });
  });
}
</script>
